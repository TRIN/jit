<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>Australian hornworts phylogeny </title>

    <!-- Test CSS -->
    <link type="text/css" href="../../Extras/PhyloJive/PhyloJive.css" rel="stylesheet"/>
    <link type="text/css" href="../../Extras/PhyloJive/Control.Loading.css" rel="stylesheet"/>
    <link type="text/css" href="../../Extras/PhyloJive/Control.Legend.css" rel="stylesheet"/>
    <link type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/themes/flick/jquery-ui.css"  rel="stylesheet"/>
    <!--<link href="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css" rel="stylesheet">-->
    <link href="http://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
    <link href='http://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v0.0.2/leaflet.fullscreen.css' rel='stylesheet' />
    <link href="../../Extras/PhyloJive/slider.css" rel="stylesheet"/>
    <link rel="stylesheet" href="../../Extras/PhyloJive/bootstrap2.0.extra.css"/>
    <!--<link href="resources/nanoscroller.css" rel="stylesheet"/>-->
</head>

<body>
<!--<button  onclick="hightlight();">Highlight</button>-->
<!--<button onclick="clearing();">Clear</button>-->
<div class="container">
    <div class="row-fluid">
        <div class="span6">
            <div id="info"></div>
        </div>
        <div role="tabpanel" id="tabs" class="span6">

            <!-- Nav tabs -->
            <ul class="nav nav-tabs" role="tablist">
                <li role="presentation"><a href="#character" aria-controls="home" role="tab" data-toggle="tab">Character</a></li>
                <li role="presentation"><a href="#map" aria-controls="profile" role="tab" data-toggle="tab" id="mapTab">Map</a></li>
                <li role="presentation" class="active"><a href="#habitat" aria-controls="profile" role="tab" data-toggle="tab" id="habitatTab">Analysis</a></li>
            </ul>

            <!-- Tab panes -->
            <div class="tab-content">
                <div role="tabpanel" class="tab-pane" id="character"></div>
                <div role="tabpanel" class="tab-pane" id="map"></div>
                <div role="tabpanel" class="tab-pane active" id="habitat"></div>
            </div>

        </div>
    </div>
</div>

<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>
<!--<script src="http://netdna.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>-->
<script src="http://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>
<script type="text/javascript" src="http://ajax.aspnetcdn.com/ajax/knockout/knockout-3.0.0.js"></script>
<script type="text/javascript" src="resources/knockout-sortable.min.js"></script>
<script type="text/javascript" src="../../Extras/PhyloJive/emitter.js"></script>


<!-- leaflet dependency -->
<script src="http://cdnjs.cloudflare.com/ajax/libs/spin.js/2.0.1/spin.min.js"></script>
<script type="text/javascript" src="../../Extras/PhyloJive/bootstrap-slider.js"></script>
<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
<script type="text/javascript"  src="../../Extras/PhyloJive/Control.Loading.js"></script>
<script src='http://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v0.0.2/Leaflet.fullscreen.min.js'></script>
<script type="text/javascript"  src="../../Extras/PhyloJive/Control.Checkbox.js"></script>
<script type="text/javascript"  src="../../Extras/PhyloJive/Control.Slider.js"></script>
<script type="text/javascript"  src="../../Extras/PhyloJive/Control.Legend.js"></script>
<script type="text/javascript"  src="../../Extras/PhyloJive/Control.Select.js"></script>
<!-- leaflet dependency END -->

<!--<script type="text/javascript" src="resources/jquery.nanoscroller.min.js"></script>-->

<!--- <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script> -->
<script type="text/javascript" src="http://www.jsphylosvg.com/js/jsphylosvg-min.js"></script>
<!--<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js"></script>-->
<!--<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.2/backbone-min.js"></script>-->
<script type="text/javascript" src="resources/jit.js"></script>
<script type="text/javascript" src="../../Extras/PhyloJive/PJ.js"></script>
<script type="text/javascript" src="../../Extras/PhyloJive/Character.js"></script>
<script type="text/javascript" src="../../Extras/PhyloJive/Map.js"></script>
<script type="text/javascript" src="../../Extras/PhyloJive/Filter.js"></script>
<script type="text/javascript" src="../../Extras/PhyloJive/Habitat.js"></script>
<script>
    var config ={
        type:'sandbox',
        sandboxLayer: 'http://sandbox.ala.org.au/biocache-service/webportal/wms/reflect',
        biocacheLayer: 'http://biocache.ala.org.au/ws/ogc/wms/reflect',
        sandboxLegend: 'http://sandbox.ala.org.au/ala-hub/occurrence/legend',
        biocacheLegend: 'http://biocache.ala.org.au/occurrence/legend',
        legendUrl: function(){
            switch (config.type){
                case 'sandbox': return config.sandboxLegend;
                case 'ala': return config.biocacheLegend;
            }
        },
        proxyUrl: 'http://localhost:8080/phylolink/ala/jsonp',
        layer: function(){
            switch (config.type){
                case 'sandbox': return config.sandboxLayer;
                case 'ala': return config.biocacheLayer;
            }
        },
        treeUrl:'https://gist.githubusercontent.com/temi/48dd52a916eb671b9382/raw/677f434d2b2512a9cb9e6b16f7b56cdbf4a1ea7a/tree.json',
        format: 'newick',
        charUrl: 'http://localhost:8080/phylolink/ala/getSandboxCharJson?drid=data_resource_uid:drt2783&fields=["phenotype_s"]&key=lineage_ID_s',
        initCharacters:['Phenotype'],
        filterParams: {
            q: 'data_resource_uid:drt2783',
            fq:{

            }
        },
        colorByUrl: 'http://localhost:8080/phylolink/ala/facets'
    }
    google.load("visualization", "1", {packages: ["corechart"]});
//    $(document).ready(function(){
        $( "#tabs" ).tab('show');
        var pj = new PJ({
            width: 500,
            height: 700,
            codeBase: '../..',
            dataType:'json',
            bootstrap: 2,
            url: config.treeUrl,
            id: 'info',
            format: config.format
        });

        var filter = new Filter($.extend(config.filterParams, {
            pj: pj,
            fqVariable:'lineage_ID_s'
        }));

        var character = new Character({
            id: "character",
            pj: pj,
            url: config.charUrl,
            dataType:'jsonp',
            height:700,
            headerHeight:41,
            initCharacters:config.initCharacters,
            bootstrap:2
        });
        var map = new Map({
            id: 'map',
            pj: pj,
            filter: filter,
            height: 650,
            width: $('#tab-content').width(),
            layer:config.layer(),
            query:config.query,
            filterFieldName:'REGNO_s',
            source: config.type,
            legend:{
                proxy: true,
                proxyUrl: config.proxyUrl,
                baseUrl: config.legendUrl(),
                dataType:'jsonp',
                urlParams:{
                    cm:undefined,
                    type:'application/json'
                },
                icon:'<i class="icon icon-list"></i> <label style="display: inline-block">Legend</label>'
            },
            env: {
                'colormode': undefined,
                'name': 'circle',
                'size': 4,
                'opacity': 0.8,
                'color': 'df4a21'
            },
            colorBy: {
                url: config.colorByUrl,
                dataType:'jsonp',
                drid: config.drid
            }
        });
        var habitat = new Habitat({
            id:'habitat',
            pj: pj,
            doSync: false
        })
        // a fix to display map tiles properly. Without it map is grey colored for majority of area.
        $("body").on("shown.bs.tab", "#mapTab", function() {
            map.invalidateSize();
        });

        google.setOnLoadCallback(character.googleChartsLoaded);
        google.setOnLoadCallback(habitat.googleChartsLoaded);
//    })
    function hightlight(){
        pj.highlight({'Homo sapiens':'value'});
    };

    function clearing(){
        console.log('clearing')
        pj.clearHighlight()
    };
//    $('.nano').nanoScroller();
</script>

</body>
</html>
